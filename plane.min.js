var canvas=document.getElementById("canvas");var context=canvas.getContext("2d");const WIDTH=canvas.width;const HEIGHT=canvas.height;const STARTTING=0;const START=1;const RUNNING=2;const PAUSED=3;const GAMEOVER=4;var state=STARTTING;var bgImg=new Image();bgImg.src="images/background.png";var BG={imgs:bgImg,width:480,height:852};function Bg(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.y1=0;this.y2=-this.height;this.paint=function(b){b.drawImage(this.imgs,0,this.y1);b.drawImage(this.imgs,0,this.y2)};this.step=function(){this.y1++;this.y2++;if(this.y1==this.height){this.y1=-this.height}if(this.y2==this.height){this.y2=-this.height}}}var bg=new Bg(BG);var logoImg=new Image();logoImg.src="images/start.png";canvas.onclick=function(){if(state==STARTTING){state=START}};var loadings=[];loadings[0]=new Image();loadings[0].src="images/game_loading1.png";loadings[1]=new Image();loadings[1].src="images/game_loading2.png";loadings[2]=new Image();loadings[2].src="images/game_loading3.png";loadings[3]=new Image();loadings[3].src="images/game_loading4.png";var LOADING={imgs:loadings,width:186,height:38,counts:loadings.length};function Loading(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.counts=a.counts;this.frameIndex=0;this.time=0;this.paint=function(b){b.drawImage(this.imgs[this.frameIndex],0,HEIGHT-this.height)};this.step=function(){this.time++;if(this.time%2==0){this.frameIndex++}if(this.frameIndex==this.counts){state=RUNNING}}}var loading=new Loading(LOADING);var heros=[];heros[0]=new Image();heros[0].src="images/hero1.png";heros[1]=new Image();heros[1].src="images/hero2.png";heros[2]=new Image();heros[2].src="images/hero_blowup_n1.png";heros[3]=new Image();heros[3].src="images/hero_blowup_n2.png";heros[4]=new Image();heros[4].src="images/hero_blowup_n3.png";heros[5]=new Image();heros[5].src="images/hero_blowup_n4.png";var HERO={imgs:heros,width:99,height:124,counts:2,len:heros.length};function Hero(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.counts=a.counts;this.length=a.len;this.frameIndex=0;this.x=(WIDTH-this.width)/2;this.y=HEIGHT-this.height-30;this.canDown=false;this.paint=function(b){b.drawImage(this.imgs[this.frameIndex],this.x,this.y)};this.step=function(){if(this.canDown){this.frameIndex++;if(this.frameIndex==(this.length-1)){life--;if(life>0){hero=new Hero(HERO)}else{if(life==0){state=GAMEOVER}}}}else{this.frameIndex=this.frameIndex==0?1:0}};this.shoot=function(){bullets[bullets.length]=new Bullet(BULLET)};this.down=function(){this.canDown=true;this.frameIndex=this.counts}}var hero=new Hero(HERO);canvas.onmousemove=function(a){if(state==RUNNING){hero.x=a.offsetX-hero.width/2;hero.y=a.offsetY-hero.height/2}};var bullet=new Image();bullet.src="images/bullet.png";var BULLET={imgs:bullet,width:9,height:21};function Bullet(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.x=hero.x+hero.width/2-this.width/2;this.y=hero.y-this.height-10;this.canDelete=false;this.paint=function(b){b.drawImage(this.imgs,this.x,this.y)};this.step=function(){this.y-=(this.height+10)}}var bullets=[];function paintBullets(){for(var a=0;a<bullets.length;a++){bullets[a].paint(context)}}function stepBullets(){for(var a=0;a<bullets.length;a++){bullets[a].step()}}function delBullets(){for(var a=0;a<bullets.length;a++){if((bullets[a].y+bullets[a].height)<=0||bullets[a].canDelete){bullets.splice(a,1)}}}var enemies1=[];enemies1[0]=new Image();enemies1[0].src="images/enemy1.png";enemies1[1]=new Image();enemies1[1].src="images/enemy1_down1.png";enemies1[2]=new Image();enemies1[2].src="images/enemy1_down2.png";enemies1[3]=new Image();enemies1[3].src="images/enemy1_down3.png";enemies1[4]=new Image();enemies1[4].src="images/enemy1_down4.png";var enemies2=[];enemies2[0]=new Image();enemies2[0].src="images/enemy2.png";enemies2[1]=new Image();enemies2[1].src="images/enemy2_down1.png";enemies2[2]=new Image();enemies2[2].src="images/enemy2_down2.png";enemies2[3]=new Image();enemies2[3].src="images/enemy2_down3.png";enemies2[4]=new Image();enemies2[4].src="images/enemy2_down4.png";var enemies3=[];enemies3[0]=new Image();enemies3[0].src="images/enemy3_n1.png";enemies3[1]=new Image();enemies3[1].src="images/enemy3_n2.png";enemies3[2]=new Image();enemies3[2].src="images/enemy3_down1.png";enemies3[3]=new Image();enemies3[3].src="images/enemy3_down2.png";enemies3[4]=new Image();enemies3[4].src="images/enemy3_down3.png";enemies3[5]=new Image();enemies3[5].src="images/enemy3_down4.png";enemies3[6]=new Image();enemies3[6].src="images/enemy3_down5.png";enemies3[7]=new Image();enemies3[7].src="images/enemy3_down6.png";var ENEMY1={imgs:enemies1,width:57,height:51,counts:1,len:enemies1.length,life:2,score:1,type:1};var ENEMY2={imgs:enemies2,width:69,height:95,counts:1,len:enemies2.length,life:50,score:10,type:2};var ENEMY3={imgs:enemies3,width:169,height:258,counts:2,len:enemies3.length,life:100,score:100,type:3};function Enemy(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.counts=a.counts;this.type=a.type;this.length=a.len;this.x=Math.random()*(WIDTH-this.width);this.y=-this.height;this.frameIndex=0;this.canDown=false;this.canDelete=false;this.life=a.life;this.score=a.score;this.paint=function(b){b.drawImage(this.imgs[this.frameIndex],this.x,this.y)};this.step=function(){if(this.canDown){this.frameIndex++;if(this.frameIndex==this.length){this.canDelete=true;this.frameIndex=this.length-1}}else{switch(this.type){case 1:this.y+=10;break;case 2:this.y+=5;break;case 3:this.frameIndex=this.frameIndex==0?1:0;this.y+=3;break}}};this.checkHit=function(b){return b.y<this.y+this.height&&b.x+b.width>this.x&&b.x<this.x+this.width&&b.y+b.height>this.y};this.down=function(){this.life--;if(this.life==0){this.canDown=true;this.frameIndex=this.counts;score+=this.score}}}var enemies=[];var time=0;function createEnemy(){time++;if(time%15==0){var b=parseInt(Math.random()*100);if(b<80){enemies[enemies.length]=new Enemy(ENEMY1)}else{if(b<90){enemies[enemies.length]=new Enemy(ENEMY2)}else{if(enemies.length>0&&enemies[0].type!=3){var a=new Enemy(ENEMY3);enemies.splice(0,0,a)}}}}}function paintEnemy(){for(var a=0;a<enemies.length;a++){enemies[a].paint(context)}}function stepEnemy(){for(var a=0;a<enemies.length;a++){enemies[a].step()}}function delEnemy(){for(var a=0;a<enemies.length;a++){if(enemies[a].y>=HEIGHT||enemies[a].canDelete){enemies.splice(a,1)}}}function checkHits(){for(var b=0;b<enemies.length;b++){if(enemies[b].checkHit(hero)&&!enemies[b].canDown&&!hero.canDown){enemies[b].down();hero.down()}for(var a=0;a<bullets.length;a++){if(enemies[b].checkHit(bullets[a])&&!enemies[b].canDown){enemies[b].down();bullets[a].canDelete=true}}}}var score=0;function paintScore(){context.font="bold 24px 微软雅黑";context.fillText("分数 : "+score,10,30)}var life=3;function paintLife(){context.fillText("生命 : "+life,380,30)}canvas.onmouseover=function(){if(state==PAUSED){state=RUNNING}};canvas.onmouseout=function(){if(state==RUNNING){state=PAUSED}};var paused=new Image();paused.src="images/game_pause_nor.png";function paintOver(){context.font="bold 48px 微软雅黑";context.fillText("GAME OVER",WIDTH/2-150,HEIGHT/2)}setInterval(function(){bg.paint(context);bg.step();switch(state){case STARTTING:context.drawImage(logoImg,10,0);break;case START:loading.paint(context);loading.step();break;case RUNNING:hero.paint(context);hero.step();hero.shoot();paintBullets();stepBullets();delBullets();createEnemy();paintEnemy();stepEnemy();delEnemy();checkHits();paintScore();paintLife();break;case PAUSED:hero.paint(context);paintBullets();paintEnemy();paintScore();paintLife();context.drawImage(paused,WIDTH/2-30,HEIGHT/2-20);break;case GAMEOVER:hero.paint(context);paintBullets();paintEnemy();paintScore();paintLife();paintOver();break}},100);