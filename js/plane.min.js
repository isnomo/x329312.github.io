(function(){var h=document.getElementById("canvas");var V=h.getContext("2d");const g=h.width;const u=h.height;const k=0;const t=1;const f=2;const s=3;const x=4;var X=k;var m=new Image();m.src="../images/background.png";var C={imgs:m,width:480,height:852};function o(Y){this.imgs=Y.imgs;this.width=Y.width;this.height=Y.height;this.y1=0;this.y2=-this.height;this.paint=function(Z){Z.drawImage(this.imgs,0,this.y1);Z.drawImage(this.imgs,0,this.y2)};this.step=function(){this.y1++;this.y2++;if(this.y1==this.height){this.y1=-this.height}if(this.y2==this.height){this.y2=-this.height}}}var S=new o(C);var P=new Image();P.src="../images/start.png";h.onclick=function(){if(X==k){X=t}};var U=[];U[0]=new Image();U[0].src="../images/game_loading1.png";U[1]=new Image();U[1].src="../images/game_loading2.png";U[2]=new Image();U[2].src="../images/game_loading3.png";U[3]=new Image();U[3].src="../images/game_loading4.png";var p={imgs:U,width:186,height:38,counts:U.length};function O(Y){this.imgs=Y.imgs;this.width=Y.width;this.height=Y.height;this.counts=Y.counts;this.frameIndex=0;this.time=0;this.paint=function(Z){Z.drawImage(this.imgs[this.frameIndex],0,u-this.height)};this.step=function(){this.time++;if(this.time%2==0){this.frameIndex++}if(this.frameIndex==this.counts){X=f}}}var R=new O(p);var n=[];n[0]=new Image();n[0].src="../images/hero1.png";n[1]=new Image();n[1].src="../images/hero2.png";n[2]=new Image();n[2].src="../images/hero_blowup_n1.png";n[3]=new Image();n[3].src="../images/hero_blowup_n2.png";n[4]=new Image();n[4].src="../images/hero_blowup_n3.png";n[5]=new Image();n[5].src="../images/hero_blowup_n4.png";var W={imgs:n,width:99,height:124,counts:2,len:n.length};function q(Y){this.imgs=Y.imgs;this.width=Y.width;this.height=Y.height;this.counts=Y.counts;this.length=Y.len;this.frameIndex=0;this.x=(g-this.width)/2;this.y=u-this.height-30;this.canDown=false;this.paint=function(Z){Z.drawImage(this.imgs[this.frameIndex],this.x,this.y)};this.step=function(){if(this.canDown){this.frameIndex++;if(this.frameIndex==(this.length-1)){L--;if(L>0){v=new q(W)}else{if(L==0){X=x}}}}else{this.frameIndex=this.frameIndex==0?1:0}};this.shoot=function(){y[y.length]=new A(G)};this.down=function(){this.canDown=true;this.frameIndex=this.counts}}var v=new q(W);h.onmousemove=function(Y){if(X==f){v.x=Y.offsetX-v.width/2;v.y=Y.offsetY-v.height/2}};var j=new Image();j.src="../images/bullet.png";var G={imgs:j,width:9,height:21};function A(Y){this.imgs=Y.imgs;this.width=Y.width;this.height=Y.height;this.x=v.x+v.width/2-this.width/2;this.y=v.y-this.height-10;this.canDelete=false;this.paint=function(Z){Z.drawImage(this.imgs,this.x,this.y)};this.step=function(){this.y-=(this.height+10)}}var y=[];function a(){for(var Y=0;Y<y.length;Y++){y[Y].paint(V)}}function w(){for(var Y=0;Y<y.length;Y++){y[Y].step()}}function K(){for(var Y=0;Y<y.length;Y++){if((y[Y].y+y[Y].height)<=0||y[Y].canDelete){y.splice(Y,1)}}}var N=[];N[0]=new Image();N[0].src="../images/enemy1.png";N[1]=new Image();N[1].src="../images/enemy1_down1.png";N[2]=new Image();N[2].src="../images/enemy1_down2.png";N[3]=new Image();N[3].src="../images/enemy1_down3.png";N[4]=new Image();N[4].src="../images/enemy1_down4.png";var J=[];J[0]=new Image();J[0].src="../images/enemy2.png";J[1]=new Image();J[1].src="../images/enemy2_down1.png";J[2]=new Image();J[2].src="../images/enemy2_down2.png";J[3]=new Image();J[3].src="../images/enemy2_down3.png";J[4]=new Image();J[4].src="../images/enemy2_down4.png";var I=[];I[0]=new Image();I[0].src="../images/enemy3_n1.png";I[1]=new Image();I[1].src="../images/enemy3_n2.png";I[2]=new Image();I[2].src="../images/enemy3_down1.png";I[3]=new Image();I[3].src="../images/enemy3_down2.png";I[4]=new Image();I[4].src="../images/enemy3_down3.png";I[5]=new Image();I[5].src="../images/enemy3_down4.png";I[6]=new Image();I[6].src="../images/enemy3_down5.png";I[7]=new Image();I[7].src="../images/enemy3_down6.png";var e={imgs:N,width:57,height:51,counts:1,len:N.length,life:2,score:1,type:1};var d={imgs:J,width:69,height:95,counts:1,len:J.length,life:50,score:10,type:2};var c={imgs:I,width:169,height:258,counts:2,len:I.length,life:100,score:100,type:3};function E(Y){this.imgs=Y.imgs;this.width=Y.width;this.height=Y.height;this.counts=Y.counts;this.type=Y.type;this.length=Y.len;this.x=Math.random()*(g-this.width);this.y=-this.height;this.frameIndex=0;this.canDown=false;this.canDelete=false;this.life=Y.life;this.score=Y.score;this.paint=function(Z){Z.drawImage(this.imgs[this.frameIndex],this.x,this.y)};this.step=function(){if(this.canDown){this.frameIndex++;if(this.frameIndex==this.length){this.canDelete=true;this.frameIndex=this.length-1}}else{switch(this.type){case 1:this.y+=10;break;case 2:this.y+=5;break;case 3:this.frameIndex=this.frameIndex==0?1:0;this.y+=3;break}}};this.checkHit=function(Z){return Z.y<this.y+this.height&&Z.x+Z.width>this.x&&Z.x<this.x+this.width&&Z.y+Z.height>this.y};this.down=function(){this.life--;if(this.life==0){this.canDown=true;this.frameIndex=this.counts;b+=this.score}}}var H=[];var M=0;function z(){M++;if(M%15==0){var Z=parseInt(Math.random()*100);if(Z<80){H[H.length]=new E(e)}else{if(Z<90){H[H.length]=new E(d)}else{if(H.length>0&&H[0].type!=3){var Y=new E(c);H.splice(0,0,Y)}}}}}function B(){for(var Y=0;Y<H.length;Y++){H[Y].paint(V)}}function Q(){for(var Y=0;Y<H.length;Y++){H[Y].step()}}function r(){for(var Y=0;Y<H.length;Y++){if(H[Y].y>=u||H[Y].canDelete){H.splice(Y,1)}}}function D(){for(var Z=0;Z<H.length;Z++){if(H[Z].checkHit(v)&&!H[Z].canDown&&!v.canDown){H[Z].down();v.down()}for(var Y=0;Y<y.length;Y++){if(H[Z].checkHit(y[Y])&&!H[Z].canDown){H[Z].down();y[Y].canDelete=true}}}}var b=0;function F(){V.font="bold 24px 微软雅黑";V.fillText("分数 : "+b,10,30)}var L=3;function l(){V.fillText("生命 : "+L,380,30)}h.onmouseover=function(){if(X==s){X=f}};h.onmouseout=function(){if(X==f){X=s}};var T=new Image();T.src="../images/game_pause_nor.png";function i(){V.font="bold 48px 微软雅黑";V.fillText("GAME OVER",g/2-150,u/2)}setInterval(function(){S.paint(V);S.step();switch(X){case k:V.drawImage(P,10,0);break;case t:R.paint(V);R.step();break;case f:v.paint(V);v.step();v.shoot();a();w();K();z();B();Q();r();D();F();l();break;case s:v.paint(V);a();B();F();l();V.drawImage(T,g/2-30,u/2-20);break;case x:v.paint(V);a();B();F();l();i();break}},100)})();